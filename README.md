# PerfXAgent客户端应用程序

## 项目简介
首先我想说“这个项目可能没有如何意义”，也可能有一些意义。我可能会写完，也可能永远完成不了。纯属好玩而已。

这是一个PC端的应用程序，与PerfXAgent云服务器连接。PerfXAgent支持Chatbot, 会议记录，翻译等Agent功能，并具有完整的h5界面。PC端被用于通过语音和文本与PerfXAgent进行交流了连接。

例如"本机的ChatBot交互逻辑"
PerfXAgent采集本机的Mic PCM流-->音频降噪等前处理-->OPUS压缩-->WebSocket发送-->服务器
PerfXAgent侦听并接收到PerfXAgent服务器WebSocket音频流-->OPUS解压缩-->PCM传输给PC喇叭驱动

## 一个有趣的故事
我是一个"老"程序员，不过已经有十多年不写代码了。大模型唤醒了我写代码的灵魂，哈哈哈，因为你不需要再花时间去复习代码的编程规范，同时也不需要去自己update的最新的知识。所以，我想尝试用一个全新的方式"写"项目，试图不写"一行"实际代码。
更多故事，参考这里：https://github.com/manwjh/perfxagent-app/blob/main/PROJECT_HISTORY.md
这是第一个界面（2025/5/24)
<img width="793" alt="image" src="https://github.com/user-attachments/assets/fe15c85c-bfa2-415a-8c99-3c26d7ab20ab" />


## 主要功能
1. PC端音频采集
   - 支持获取PC麦克风音频输入
   - 实时音频数据采集和处理
   - 流式音频传输
   - 高级音频处理
     * 降噪算法（Noise Reduction）
     * 自动增益控制（AGC）
     * 声纹识别（Voice Print Recognition）

2. 服务器通信
   - 基于WebSocket的实时双向通信
   - 音频数据传输
   - 服务器处理结果接收

3. 音频播放功能
   - 支持播放服务器实时传输的音频流
   - 支持播放本地音频文件（MP3/WAV格式）
   - 支持音频播放控制（播放、暂停、停止、音量调节）

4. 用户界面
   - 对话界面
   - 音频设置界面
   - 云端Agent界面

5. H5页面集成
   - 支持服务器H5页面在本地程序中的显示
   - 本地程序与H5页面的交互

## 技术架构

### 前端技术栈
- Electron (用于构建跨平台桌面应用)
- React (用户界面开发)
- WebSocket (实时通信)
- Web Audio API (音频处理和播放)
- MediaRecorder API (音频采集)
- WebAssembly (音频处理算法)

### 音频处理
1. 音频采集
   - 采样率：24kHz
   - 位深度：16bit
   - 通道数：单声道
   - 流式处理：实时采集和传输

2. 音频处理算法
   - 降噪处理
     * 频谱减法降噪
     * 自适应滤波降噪
     * 深度学习降噪
   - 自动增益控制（AGC）
     * 动态范围压缩
     * 电平自适应调节
   - 声纹识别
     * 声纹特征提取
     * 声纹匹配算法
     * 实时声纹验证

3. 音频播放
   - 支持格式：MP3, WAV, OPUS
   - 实时音频流播放
   - 本地音频文件播放
   - 音频可视化

### 通信协议
详细的WebSocket通信协议请参考 [websocket-protocol.md](./websocket-protocol.md)

### 系统要求
- 操作系统：Windows 10/11, macOS 10.15+
- 内存：4GB以上
- 存储空间：500MB以上可用空间

## 开发环境搭建
1. 安装Node.js (v16.0.0+)
2. 安装项目依赖
```bash
npm install
```
3. 启动开发服务器
```bash
npm run dev
```

## 用户界面设计

### 1. 登录界面
#### 1.1 服务器连接
- 自动与服务器建立WebSocket连接
- 连接状态显示
- 重连机制
- 错误提示

#### 1.2 用户授权（预留）
- 用户登录表单
- 授权状态显示
- 记住登录状态选项

### 2. 音频设置界面
#### 2.1 音频源选择
- 显示所有可用的音频输入设备
- 支持实时切换音频源
- 显示设备详细信息（采样率、通道数等）

#### 2.2 音频参数配置
- 采样率选择（默认16kHz）
- 位深度设置
- 通道数选择
- 音频处理选项
  * 降噪开关
  * AGC开关
  * 声纹识别开关

#### 2.3 音频测试功能
- 录音测试按钮
- 实时音量显示
- 录音回放功能
- 音频波形可视化

### 3. 服务器配置界面
#### 3.1 服务器设置
- WebSocket服务器URL配置
- 连接参数设置
- 协议版本选择
- 连接测试功能

### 4. 对话界面
#### 4.1 实时对话功能
- 对讲按钮（按住说话）
- 录音状态显示
- 实时音量指示
- 音频处理状态显示

#### 4.2 服务器交互
- 等待服务器响应状态
- 服务器返回音频播放
- 对话历史记录
- 错误提示和重试机制

## 界面交互流程

1. 启动流程
```
启动应用 -> 登录界面 -> 服务器连接 -> 音频设置 -> 对话界面
```

2. 音频设置流程
```
选择音频源 -> 配置参数 -> 测试录音 -> 确认设置
```

3. 对话流程
```
按住对讲按钮 -> 开始录音 -> 流式传输 -> 松开按钮 -> 等待响应 -> 播放回复
```

## 项目结构
```
project/
├── src/
│   ├── main/           # Electron主进程
│   ├── renderer/       # 渲染进程
│   ├── components/     # React组件
│   │   ├── login/      # 登录界面组件
│   │   ├── settings/   # 设置界面组件
│   │   │   ├── audio/  # 音频设置
│   │   │   └── server/ # 服务器设置
│   │   └── chat/       # 对话界面组件
│   ├── audio/          # 音频处理模块
│   │   ├── recorder/   # 音频采集
│   │   ├── player/     # 音频播放
│   │   ├── processor/  # 音频处理
│   │   │   ├── noise/  # 降噪算法
│   │   │   ├── agc/    # 自动增益控制
│   │   │   └── voice/  # 声纹识别
│   │   └── stream/     # 流式处理
│   └── utils/          # 工具函数
├── public/             # 静态资源
└── package.json        # 项目配置
```

## 注意事项
1. 首次使用需要授予麦克风和音频输出设备访问权限
2. 确保网络连接稳定以保证WebSocket通信质量
3. 建议使用耳机进行音频采集，避免回声
4. 音频播放时注意音量控制，避免突然的大音量输出
5. 流式音频处理需要较高的CPU资源，建议在性能较好的设备上运行
6. 声纹识别功能需要预先采集用户声纹样本
7. 界面切换时注意保存用户设置
8. 确保音频设备切换时的平滑过渡

## 许可证
MIT License 
